/* angular-data-depend - v1.0.0 - 2013-08-01 | (c) 2013 Nico Rehwaldt | MIT */
!function(a){function b(a){function b(a){return d(a)?a:[a]}var c=a.module("dataDepend",[]),d=a.isArray,e=a.isFunction,f=(a.isObject,a.forEach);a.extend;var g=["$rootScope","$q",function(a,b){function c(a){function c(c){function e(a){B.value=a,B.$loaded=!0,y=!1,i(function(a){a.parentChanged()})}function g(){B.$loaded=!1,z=!1}function h(a){var b=r[a];if(!b)throw new Error("[dataDepend] No provider for "+a);return b}function i(a){f(x,a)}function j(a){f(s,a)}function k(){var a=[];return j(function(b){var c=h(b),d=c.resolve().then(function(a){var c=w[b];return c!=a&&(w[b]=a,y=!0),a});a.push(d)}),a}function l(a){g();var c=b.all(k()).then(function(b){var c=n();return t&&(y||a||0==b.length)&&(c=t.apply(t,b)),c}).then(function(a){return A===c&&(A=null),e(a),a});return c}function m(){A||(z=!0,u&&a(function(){o()}),i(function(a){a.parentChanged()}))}function n(){return B.value}function o(a){a=a||{};var c=a.reload,d=a.name;if(d&&!v)throw new Error("[dataDepend] Cannot resolve name "+d+" no multi-provider");(z||c)&&(A=l(c));var e;return e=A?A:b.when(n()),d&&(e=e.then(function(a){var b=q.indexOf(d);return a[b]})),e}function p(a){if(t)throw new Error("[dataDepend] Cannot set value, was using factory");e(a)}c=c||{};var q=c.produces,r=c.registry,s=c.dependencies||[],t=c.factory,u=c.eager||!1,v=d(q),w={},x=[],y=!0,z=!0,A=null,B={$loaded:!1},C={produces:q,data:B,get:n,set:p,resolve:o,children:x,parentChanged:m};return j(function(a){h(a).children.push(C)}),u&&a(function(){o()}),t||e(c.value),C}return{create:c}}return c(function(b){a.$evalAsync(b)})}],h=["$rootScope","$injector","dataProviderFactory",function(c,f,g){function h(c){function f(){function f(a,f){var g="provider$"+k++;if(f?a=b(a):(f=a,a=c(f),d(f)&&(f=f[f.length-1])),!e(f))throw new Error('[dataDepend] Must provide callback as second parameter or use [ "A", "B", function(a, b) { } ] notation');var i=h({produces:g,factory:f,dependencies:a,eager:!0,registry:l});return i.data}function h(b){var c,e=b.produces;if(!e)throw new Error("[dataDepend] Must provide produces when creating new provider");if(c=g.create(b),d(e)){var f=c.resolve;a.forEach(e,function(b){l[b]=a.extend({},c,{resolve:function(c){return c=a.extend(c||{},{name:b}),f(c)}})})}else l[e]=c;return c}function i(a,b){var f,g,i=l[a];if(i)return i.set(b),void 0;(e(b)||d(b))&&(f=b,g=c(f),b=void 0,d(f)&&(f=f[f.length-1]));var i=h({produces:a,factory:f,value:b,dependencies:g,registry:l});return i.data}function j(a){var b=l[a];if(!b)throw new Error('[dataDepend] Provider "'+a+'" does not exists');b.resolve({reload:!0})}var k=0,l={};return{$providers:l,get:f,set:i,changed:j}}return{create:f}}return h(f.annotate,function(a){c.$evalAsync(a)})}];return c.factory("dataDependFactory",h),c.factory("dataProviderFactory",g),c}if("function"==typeof define&&define.amd)define(["angular"],function(a){return b(a)});else{if(void 0===typeof a)throw new Error("Cannot bind dataDepend: AngularJS not available on window or via AMD");b(a)}}(angular);